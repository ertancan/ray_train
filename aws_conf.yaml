cluster_name: verita-security-7b

# The maximum number of worker nodes to launch in addition to the head
# node.
min_workers: 16
max_workers: 17
upscaling_speed: 1.0
docker:
  image: "rayproject/ray-ml:latest-gpu" # You can change this to latest-cpu if you don't need GPU support and want a faster startup
    # image: rayproject/ray:latest-gpu   # use this one if you don't need ML dependencies, it's faster to pull
  container_name: "ray_container"
  # If true, pulls latest version of image. Otherwise, `docker run` will only pull the image
  # if no cached version is present.
  pull_before_run: True
  run_options:  # Extra options to pass into "docker run"
    - --ulimit nofile=65536:65536

provider:
    type: aws
    region: eu-central-1

auth:
  ssh_user: ubuntu


available_node_types:
    worker:
        min_workers: 4
        max_workers: 4
        node_config:
            InstanceType: g5.4xlarge
            BlockDeviceMappings:
                - DeviceName: /dev/sda1
                  Ebs:
                      VolumeSize: 140
                      VolumeType: gp3
    ray.head.default:
        min_workers: 1
        max_workers: 1
        node_config:
            InstanceType: m5.xlarge
            BlockDeviceMappings:
                - DeviceName: /dev/sda1
                  Ebs:
                      VolumeSize: 140
                      VolumeType: gp3

head_node_type: ray.head.default

head_setup_commands:
    - sudo mkdir /mnt/local_storage || true
    - sudo chmod 777 /mnt/local_storage
    - sudo apt-get update
    - sudo apt-get install awscli -y --fix-missing
    - pip install pip install ray==2.7.0rc0
    - rm -rf ray_train
    - git clone https://github.com/ertancan/ray_train.git
    - aws s3 cp s3://forensic-training-data/ray/ ray_train/training_data --recursive
    - chmod +x ray_train/run_llama_ft.sh

worker_setup_commands:
    - pip install pip install ray==2.7.0rc0
    - sudo mkdir /mnt/local_storage || true
    - sudo chmod 777 /mnt/local_storage
    - sudo apt-get update
    - sudo apt-get install awscli -y --fix-missing
